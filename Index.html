<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Lista de URLs — X4<span style="color:#F78D4C">4</span>Plan</title>

  <style>
    :root{
      --accent: #F78D4C;
      --navy: #0b1220;
      --text: #222;
      --muted: #6b7280;
    }

    body{
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      margin: 24px;
      color: var(--text);
      background: #ffffff;
    }

    header{
      display:flex;
      align-items:center;
      gap:12px;
      margin-bottom:20px;
    }

    .logo{
      font-weight:700;
      font-size:20px;
      color:var(--navy);
    }

    .logo span { color:#ffffff; background:var(--navy); padding:2px 6px; border-radius:2px; margin-right:4px; }
    .logo .four { color:var(--accent); background:transparent; padding:0; }

    .lead { margin:4px 0 18px 0; color:var(--muted); max-width:760px; }

    #controls{
      display:flex;
      gap:8px;
      margin-bottom:14px;
      align-items:center;
      flex-wrap:wrap;
    }

    button.btn {
      padding:8px 12px;
      border-radius:6px;
      border:1px solid rgba(0,0,0,0.06);
      background:#ffffff;
      cursor:pointer;
      font-weight:600;
    }

    button.primary {
      background:var(--accent);
      color:white;
      border:none;
    }

    #copyArea {
      width:100%;
      min-height:44px;
      padding:10px;
      border-radius:6px;
      border:1px solid #e6e9ee;
      font-family:monospace;
      white-space:pre-wrap;
      overflow:auto;
      background:#fbfbfd;
      margin-bottom:14px;
    }

    #buttons {
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      margin-top:8px;
    }

    .link-btn {
      padding:8px 10px;
      border-radius:6px;
      border:1px solid #e6e9ee;
      background:#fff;
      cursor:pointer;
      text-decoration:none;
      color:var(--navy);
      font-size:13px;
      max-width:420px;
      overflow:hidden;
      text-overflow:ellipsis;
      white-space:nowrap;
      display:inline-block;
    }

    .meta { color:var(--muted); font-size:13px; margin-top:12px; }

    .warning { color:#b44; margin-top:10px; }

    footer { margin-top:28px; color:var(--muted); font-size:13px; }
  </style>
</head>
<body>
  <header>
    <div class="logo"><span>X4</span><span class="four">4</span>Plan</div>
    <div>
      <strong>Lista de URLs</strong>
      <div class="meta">Fonte: <code>https://www.x4plan.com.br/pages-sitemap.xml</code></div>
    </div>
  </header>

  <p class="lead">Esta página carrega automaticamente o sitemap do site e lista todas as URLs como links clicáveis e como texto pronto para copiar. Use o botão <strong>Atualizar</strong> para recarregar a lista.</p>

  <div id="controls">
    <button class="btn primary" id="refreshBtn">Atualizar</button>
    <button class="btn" id="copyBtn">Copiar todas as URLs</button>
    <button class="btn" id="downloadTxtBtn">Baixar .txt</button>
    <div style="margin-left:8px;color:var(--muted);font-size:13px;">Total: <span id="count">0</span></div>
  </div>

  <div id="copyArea" aria-live="polite">A lista será carregada aqui...</div>

  <div id="buttons" aria-label="Lista de links"></div>

  <div id="corsWarning" class="warning" style="display:none;">
    Atenção: o navegador bloqueou o acesso direto ao sitemap por políticas CORS do servidor. Se isto ocorrer, use a versão estática (arquivo gerado) ou faça o deploy do HTML com uma cópia das URLs (instruções abaixo).
  </div>

  <footer>
    Se preferir, gere um arquivo estático com as URLs e faça upload para GitHub Pages ou Netlify.<br>
    Contato X4Plan: www.x4plan.com.br — WhatsApp corporativo (11) 99994-6556 — @x4plan
  </footer>

<script>
  const SITEMAP = 'https://www.x4plan.com.br/pages-sitemap.xml';
  const refreshBtn = document.getElementById('refreshBtn');
  const copyBtn = document.getElementById('copyBtn');
  const downloadTxtBtn = document.getElementById('downloadTxtBtn');
  const buttonsDiv = document.getElementById('buttons');
  const copyArea = document.getElementById('copyArea');
  const countSpan = document.getElementById('count');
  const corsWarning = document.getElementById('corsWarning');

  async function fetchSitemapAndRender(){
    buttonsDiv.innerHTML = '';
    copyArea.textContent = 'Carregando...';
    countSpan.textContent = '0';
    corsWarning.style.display = 'none';

    try {
      const res = await fetch(SITEMAP, {cache: "no-store"});
      if (!res.ok) throw new Error('HTTP ' + res.status);
      const xmlText = await res.text();
      const parser = new DOMParser();
      const xml = parser.parseFromString(xmlText, "application/xml");
      const locs = Array.from(xml.getElementsByTagName('loc')).map(n => n.textContent.trim());
      if(locs.length === 0){
        copyArea.textContent = 'Nenhuma URL encontrada no sitemap ou formato inesperado.';
        return;
      }

      countSpan.textContent = locs.length;
      copyArea.textContent = locs.join('\\n');

      locs.forEach(url => {
        const a = document.createElement('a');
        a.href = url;
        a.className = 'link-btn';
        a.target = '_blank';
        a.rel = 'noopener noreferrer';
        a.title = url;
        a.textContent = url;
        buttonsDiv.appendChild(a);
      });

    } catch (err) {
      console.error('Erro ao buscar sitemap:', err);
      copyArea.textContent = 'Erro ao carregar o sitemap: ' + err.message + '\\n\\nPossível bloqueio CORS. Veja instruções na página sobre como gerar um arquivo estático caso necessário.';
      corsWarning.style.display = 'block';
    }
  }

  refreshBtn.addEventListener('click', fetchSitemapAndRender);

  copyBtn.addEventListener('click', async () => {
    try {
      await navigator.clipboard.writeText(copyArea.textContent);
      copyBtn.textContent = 'Copiado!';
      setTimeout(()=> copyBtn.textContent = 'Copiar todas as URLs', 1600);
    } catch(e){
      const ta = document.createElement('textarea');
      ta.value = copyArea.textContent;
      document.body.appendChild(ta);
      ta.select();
      document.execCommand('copy');
      document.body.removeChild(ta);
      copyBtn.textContent = 'Copiado!';
      setTimeout(()=> copyBtn.textContent = 'Copiar todas as URLs', 1600);
    }
  });

  downloadTxtBtn.addEventListener('click', () => {
    const blob = new Blob([copyArea.textContent], {type:'text/plain;charset=utf-8'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'x4plan-urls.txt';
    document.body.appendChild(a);
    a.click();
    a.remove();
    URL.revokeObjectURL(url);
  });

  fetchSitemapAndRender();
</script>
</body>
</html>
